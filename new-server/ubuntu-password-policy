
#!/bin/bash
apt install -y auditd
apt install -y libpam-pwquality
mv /etc/pam.d/login /etc/pam.d/login.old
touch /etc/pam.d/login
echo "auth       optional   pam_faildelay.so  delay=3000000
auth       requisite  pam_nologin.so
auth       required   pam_tally2.so onerr=fail deny=5 unlock_time=1800 audit even_deny_root root_unlock_time=1800
session [success=ok ignore=ignore module_unknown=ignore default=bad] pam_selinux.so close
session    required     pam_loginuid.so
session    optional   pam_motd.so motd=/run/motd.dynamic
session    optional   pam_motd.so noupdate
session [success=ok ignore=ignore module_unknown=ignore default=bad] pam_selinux.so open
session       required   pam_env.so readenv=1
session       required   pam_env.so readenv=1 envfile=/etc/default/locale
@include common-auth
auth       optional   pam_group.so
session    required   pam_limits.so
session    optional   pam_lastlog.so
session    optional   pam_mail.so standard
session    optional   pam_keyinit.so force revoke
@include common-account
@include common-session
@include common-password" > /etc/pam.d/login
mv /etc/pam.d/common-password /etc/pam.d/common-password.old
touch /etc/pam.d/common-password
echo "password        requisite                       pam_pwquality.so retry=3 minlen=8 difok=4 lcredit=-1 ucredit=-1 dcredit=-1 ocredit=-1 reject_username enforce_for_root
password        [success=1 default=ignore]      pam_unix.so obscure use_authtok try_first_pass sha512 remember=4 enforce_for_root
password        requisite                       pam_deny.so
password        required                        pam_permit.so" > /etc/pam.d/common-password
mv /etc/pam.d/common-auth /etc/pam.d/common-auth.old
touch /etc/pam.d/common-auth
echo "auth    [success=1 default=ignore]      pam_unix.so nullok_secure remember=4 enforce_for_root
auth    requisite                       pam_deny.so
auth    required                        pam_permit.so
auth    optional                        pam_cap.so" > /etc/pam.d/common-auth
mv /etc/login.defs /etc/login.defs.old
touch /etc/login.defs
echo "MAIL_DIR        /var/mail
FAILLOG_ENAB            yes
LOG_UNKFAIL_ENAB        no
LOG_OK_LOGINS           no
SYSLOG_SU_ENAB          yes
SYSLOG_SG_ENAB          yes
FTMP_FILE       /var/log/btmp
SU_NAME         su
HUSHLOGIN_FILE  .hushlogin
ENV_SUPATH      PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
ENV_PATH        PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
TTYGROUP        tty
TTYPERM         0600
ERASECHAR       0177
KILLCHAR        025
UMASK           022
PASS_MAX_DAYS   90
PASS_MIN_DAYS   0
PASS_WARN_AGE   7
PASS_MIN_LEN    8
UID_MIN                  1000
UID_MAX                 60000
GID_MIN                  1000
GID_MAX                 60000
LOGIN_RETRIES           5
CHFN_RESTRICT           rwh
DEFAULT_HOME    yes
USERGROUPS_ENAB yes
ENCRYPT_METHOD SHA512" > /etc/login.defs
# ssh 15'
sed -i 's/#ClientAliveInterval 0/ClientAliveInterval 900/' /etc/ssh/sshd_config
systemctl restart sshd
# auto logout
touch /etc/profile.d/auto-logout.sh
echo "#!/bin/bash
export TMOUT=900" > /etc/profile.d/auto-logout.sh
chmod +x /etc/profile.d/auto-logout.sh
sh -c 'echo "export TMOUT=900" >> /root/.bashrc'
# mv /etc/security/pwquality.conf /etc/security/pwquality.conf.old
# touch /etc/security/pwquality.conf
# echo "difok = 4
# minlen = 8
# dcredit = 1
# ucredit = 1
# lcredit = 1
# ocredit = 1
# minclass = 4" > /etc/security/pwquality.conf
